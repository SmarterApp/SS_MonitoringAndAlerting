<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans" 
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
    xmlns:util="http://www.springframework.org/schema/util" 
    xmlns:context="http://www.springframework.org/schema/context"
    xsi:schemaLocation="
                http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
                http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-3.0.xsd
                http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd">

    <context:component-scan base-package="org.opentestsystem.shared.monitoringalerting.persistence" />

    <bean id="alertService" class="org.opentestsystem.shared.monitoringalerting.service.impl.AlertServiceImpl" />
    <bean id="logService" class="org.opentestsystem.shared.monitoringalerting.service.impl.LogServiceImpl" />
    <bean id="metricService" class="org.opentestsystem.shared.monitoringalerting.service.impl.MetricServiceImpl" />
    <bean id="discreteIntakeService" class="org.opentestsystem.shared.monitoringalerting.service.impl.DiscreteIntakeServiceImpl" />

    <bean id="abstractNotificationService" abstract="true" class="org.opentestsystem.shared.monitoringalerting.service.AbstractNotificationService">
        <property name="emailActive" value="${mna.email.active}"/>
        <property name="fromAddress" value="${mna.email.address.from}"/>
        <property name="subjectPrefix" value="${mna.email.subject.prefix}"/>
    </bean>

    <bean id="logNotificationService" class="org.opentestsystem.shared.monitoringalerting.service.impl.LogNotificationServiceImpl"  parent="abstractNotificationService"/>
    <bean id="alertNotificationService" class="org.opentestsystem.shared.monitoringalerting.service.impl.AlertNotificationServiceImpl" parent="abstractNotificationService"/>

    <bean id="notificationGroupService" class="org.opentestsystem.shared.monitoringalerting.service.impl.NotificationGroupServiceImpl" />
    <bean id="notificationRuleService" class="org.opentestsystem.shared.monitoringalerting.service.impl.NotificationRuleServiceImpl" />
    
    
    <bean id="mailSender" class="org.springframework.mail.javamail.JavaMailSenderImpl">
        <property name="host" value="${mna.email.host}"/>
        <property name="port" value="${mna.email.port}"/>
        <property name="username" value="${mna.email.user}"/>
        <property name="password" value="${mna.email.password}"/>
        <property name="javaMailProperties">
            <props>
                <!-- Use TLS to encrypt communication with SMTP server -->
                <prop key="mail.smtp.starttls.enable">${mna.email.smtp.starttls.enable}</prop>
                <!-- Use SMTP transport protocol -->
                <prop key="mail.transport.protocol">${mna.email.transport.protocol}</prop>
                <!-- Use SMTP-AUTH to authenticate to SMTP server -->
                <prop key="mail.smtp.auth">${mna.email.smtp.auth}</prop>
                <prop key="mail.smtp.ssl.enable">${mna.email.smtp.ssl.enable}</prop>
                <prop key="mail.debug">true</prop>
            </props>
        </property>
    </bean>
    
    <bean id="logCleanupService" class="org.opentestsystem.shared.monitoringalerting.service.impl.LogCleanupServiceImpl"/>
    

</beans>
